# ç½‘ç»œè‡ªåŠ¨åŒ–å·¡æ£€é¡¹ç›® - å®éªŒæ‹“æ‰‘è®¾è®¡æ–¹æ¡ˆ

> **é¡¹ç›®åç§°**: Pythonç½‘ç»œè®¾å¤‡è‡ªåŠ¨åŒ–å·¡æ£€å¹³å°  
> **æ‹“æ‰‘ç›®æ ‡**: æ¨¡æ‹ŸçœŸå®ä¼ä¸šç½‘ç»œç¯å¢ƒï¼Œæ”¯æŒè‡ªåŠ¨åŒ–å·¡æ£€åŠŸèƒ½æµ‹è¯•  
> **æ¨èæ¨¡æ‹Ÿå™¨**: åä¸ºeNSP / EVE-NG / GNS3

---

## ğŸ“‹ ç›®å½•

1. [æ‹“æ‰‘æ–¹æ¡ˆæ¦‚è§ˆ](#æ‹“æ‰‘æ–¹æ¡ˆæ¦‚è§ˆ)
2. [æ–¹æ¡ˆä¸€ï¼šå°å‹ä¼ä¸šç½‘ç»œï¼ˆæ¨èå…¥é—¨ï¼‰](#æ–¹æ¡ˆä¸€å°å‹ä¼ä¸šç½‘ç»œ)
3. [æ–¹æ¡ˆäºŒï¼šä¸­å‹å›­åŒºç½‘ç»œï¼ˆè¿›é˜¶ï¼‰](#æ–¹æ¡ˆäºŒä¸­å‹å›­åŒºç½‘ç»œ)
4. [æ–¹æ¡ˆä¸‰ï¼šå¤šç«™ç‚¹ä¼ä¸šç½‘ç»œï¼ˆé«˜çº§ï¼‰](#æ–¹æ¡ˆä¸‰å¤šç«™ç‚¹ä¼ä¸šç½‘ç»œ)
5. [è®¾å¤‡é…ç½®æ¸…å•](#è®¾å¤‡é…ç½®æ¸…å•)
6. [è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯](#è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯)

---

## ğŸ¯ æ‹“æ‰‘æ–¹æ¡ˆæ¦‚è§ˆ

### è®¾è®¡åŸåˆ™
1. **å±‚æ¬¡åŒ–æ¶æ„**: æ ¸å¿ƒå±‚ã€æ±‡èšå±‚ã€æ¥å…¥å±‚æ¸…æ™°åˆ†ç¦»
2. **å†—ä½™æ€§**: å…³é”®é“¾è·¯åŒå¤‡ä»½ï¼Œæµ‹è¯•é«˜å¯ç”¨åè®®
3. **åè®®å¤šæ ·æ€§**: æ¶µç›–OSPFã€BGPã€VRRPç­‰å…³é”®åè®®
4. **æ˜“äºæ‰©å±•**: å¯æ ¹æ®å­¦ä¹ è¿›åº¦é€æ­¥å¢åŠ è®¾å¤‡

### ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | è®¾å¤‡æ•°é‡ | å¤æ‚åº¦ | é€‚ç”¨é˜¶æ®µ | èµ„æºéœ€æ±‚ |
|------|---------|-------|---------|---------|
| æ–¹æ¡ˆä¸€ | 6-8å° | â­â­ | å…¥é—¨/å¿«é€ŸéªŒè¯ | 4GBå†…å­˜ |
| æ–¹æ¡ˆäºŒ | 12-15å° | â­â­â­â­ | è¿›é˜¶/å®Œæ•´æµ‹è¯• | 8GBå†…å­˜ |
| æ–¹æ¡ˆä¸‰ | 20+å° | â­â­â­â­â­ | é«˜çº§/ç”Ÿäº§æ¨¡æ‹Ÿ | 16GBå†…å­˜ |

---

## æ–¹æ¡ˆä¸€ï¼šå°å‹ä¼ä¸šç½‘ç»œï¼ˆæ¨èå…¥é—¨ï¼‰

### æ‹“æ‰‘æ¶æ„å›¾

```
                   Internet
                      |
                 [R-WAN1]  (è¾¹ç•Œè·¯ç”±å™¨)
                      |
            +--------[SW-Core1]--------+  (æ ¸å¿ƒäº¤æ¢æœº)
            |                          |
       [SW-Access1]              [SW-Access2]  (æ¥å…¥äº¤æ¢æœº)
            |                          |
      [PC1] [PC2]                [Server1] [Server2]
```

### è®¾å¤‡æ¸…å•

| åºå· | è®¾å¤‡åç§° | è®¾å¤‡ç±»å‹ | IPåœ°å€ | ç”¨é€” |
|------|---------|---------|--------|------|
| 1 | R-WAN1 | è·¯ç”±å™¨ (AR2220) | 10.0.0.1/24 (Mgmt) | è¾¹ç•Œè·¯ç”±ï¼Œè¿è¡ŒBGP |
| 2 | SW-Core1 | æ ¸å¿ƒäº¤æ¢æœº (S5700) | 10.0.0.10/24 | æ ¸å¿ƒäº¤æ¢ï¼Œè¿è¡ŒOSPF |
| 3 | SW-Access1 | æ¥å…¥äº¤æ¢æœº (S3700) | 10.0.0.20/24 | æ¥å…¥å±‚ |
| 4 | SW-Access2 | æ¥å…¥äº¤æ¢æœº (S3700) | 10.0.0.21/24 | æ¥å…¥å±‚ |
| 5 | Server1 | LinuxæœåŠ¡å™¨ | 192.168.10.100/24 | å·¡æ£€æœåŠ¡å™¨ï¼ˆè¿è¡ŒPythonè„šæœ¬ï¼‰ |

### åè®®é…ç½®

**1. ç®¡ç†ç½‘ç»œ**
- æ‰€æœ‰è®¾å¤‡é…ç½®å•ç‹¬çš„ç®¡ç†VLAN (VLAN 99)
- ç®¡ç†ç½‘æ®µï¼š10.0.0.0/24
- å¯ç”¨SSHæœåŠ¡ï¼ˆç”¨äºè‡ªåŠ¨åŒ–è¿æ¥ï¼‰

**2. è·¯ç”±åè®®**
- æ ¸å¿ƒå±‚è¿è¡ŒOSPFï¼ˆArea 0ï¼‰
- è¾¹ç•Œè·¯ç”±å™¨è¿è¡ŒBGPï¼ˆä¸ISPå¯¹æ¥ï¼‰

**3. é«˜å¯ç”¨**
- æ ¸å¿ƒäº¤æ¢æœºé…ç½®VRRPï¼ˆè™šæ‹ŸIPï¼‰
- æ¥å…¥å±‚ä½¿ç”¨MSTPé˜²ç¯

### eNSPé…ç½®ç¤ºä¾‹

#### R-WAN1 (è¾¹ç•Œè·¯ç”±å™¨)
```
sys
sysname R-WAN1

# é…ç½®ç®¡ç†æ¥å£
interface GigabitEthernet0/0/0
 ip address 10.0.0.1 255.255.255.0
 description Management

# å¯ç”¨SSH
user-interface vty 0 4
 authentication-mode aaa
 protocol inbound ssh

aaa
 local-user netconftest password cipher huaweiDC
 local-user netconftest privilege level 15
 local-user netconftest service-type ssh

ssh user netconftest authentication-type password
ssh user netconftest service-type stelnet

stelnet server enable

# å¯ç”¨SNMP
snmp-agent
snmp-agent sys-info version v2c
snmp-agent community read public
```

#### SW-Core1 (æ ¸å¿ƒäº¤æ¢æœº)
```
sys
sysname SW-Core1

# ç®¡ç†VLAN
vlan 99
 description Management

interface Vlanif99
 ip address 10.0.0.10 255.255.255.0

# ä¸šåŠ¡VLAN
vlan batch 10 20 30

interface Vlanif10
 description Server-VLAN
 ip address 192.168.10.1 255.255.255.0

# OSPFé…ç½®
ospf 1 router-id 10.0.0.10
 area 0.0.0.0
  network 10.0.0.0 0.0.0.255
  network 192.168.10.0 0.0.0.255

# å¯ç”¨SSHï¼ˆåŒR-WAN1é…ç½®ï¼‰
# å¯ç”¨SNMPï¼ˆåŒR-WAN1é…ç½®ï¼‰
```

### å·¡æ£€è„šæœ¬æµ‹è¯•åœºæ™¯

**åœºæ™¯1ï¼šåŸºç¡€è¿é€šæ€§æ£€æµ‹**
```python
devices = [
    {'host': '10.0.0.1', 'name': 'R-WAN1'},
    {'host': '10.0.0.10', 'name': 'SW-Core1'},
    {'host': '10.0.0.20', 'name': 'SW-Access1'},
]

# æµ‹è¯•Ping
for device in devices:
    result = ping(device['host'])
    print(f"{device['name']}: {'åœ¨çº¿' if result else 'ç¦»çº¿'}")
```

**åœºæ™¯2ï¼šè®¾å¤‡ä¿¡æ¯é‡‡é›†**
- `display version` - ç³»ç»Ÿç‰ˆæœ¬
- `display cpu-usage` - CPUä½¿ç”¨ç‡
- `display memory-usage` - å†…å­˜ä½¿ç”¨ç‡
- `display interface brief` - æ¥å£çŠ¶æ€

**åœºæ™¯3ï¼šSNMPé‡‡é›†**
- CPU: OID `.1.3.6.1.4.1.2011.5.25.31.1.1.1.1.5`
- å†…å­˜: OID `.1.3.6.1.4.1.2011.6.1.2.1.1.2`

---

## æ–¹æ¡ˆäºŒï¼šä¸­å‹å›­åŒºç½‘ç»œï¼ˆè¿›é˜¶ï¼‰

### æ‹“æ‰‘æ¶æ„å›¾

```
                        Internet
                           |
                   +------[FW1]------+  (é˜²ç«å¢™)
                   |                 |
              [R-WAN1]           [R-WAN2]  (è¾¹ç•Œè·¯ç”±å™¨å†—ä½™)
                   |                 |
         +---------+-----------------+---------+
         |                                     |
    [SW-Core1]------VRRP/å †å ------[SW-Core2]  (æ ¸å¿ƒå±‚)
         |                                 |
    +----+----+                       +----+----+
    |         |                       |         |
[SW-Agg1] [SW-Agg2]             [SW-Agg3] [SW-Agg4]  (æ±‡èšå±‚)
    |         |                       |         |
[SW-Acc1][SW-Acc2]               [SW-Acc3][SW-Acc4]  (æ¥å…¥å±‚)
    |         |                       |         |
  Clients  Clients                 Servers   Servers
```

### è®¾å¤‡æ¸…å•ï¼ˆ15å°è®¾å¤‡ï¼‰

| å±‚çº§ | è®¾å¤‡åç§° | æ•°é‡ | å‹å·å»ºè®® | ä¸»è¦åè®® |
|------|---------|------|---------|---------|
| è¾¹ç•Œ | R-WAN1/2 | 2 | AR2220 | BGP, OSPF |
| æ ¸å¿ƒ | SW-Core1/2 | 2 | S5700 | OSPF, VRRP, MSTP |
| æ±‡èš | SW-Agg1/2/3/4 | 4 | S5700 | OSPF, VLAN |
| æ¥å…¥ | SW-Acc1/2/3/4 | 4 | S3700 | VLAN, STP |
| å®‰å…¨ | FW1 | 1 | USG6000 | NAT, ACL |
| æœåŠ¡å™¨ | Server1 | 1 | Linux | è¿è¡Œå·¡æ£€è„šæœ¬ |

**æ€»è®¡**: 13å°ç½‘ç»œè®¾å¤‡ + 1å°æœåŠ¡å™¨ + è‹¥å¹²PC

### IPåœ°å€è§„åˆ’

| ç½‘æ®µ | ç”¨é€” | VLAN | ç½‘å…³ |
|------|------|------|------|
| 10.0.0.0/24 | è®¾å¤‡ç®¡ç† | 99 | 10.0.0.1 |
| 172.16.1.0/24 | æ ¸å¿ƒäº’è” | - | - |
| 192.168.10.0/24 | æœåŠ¡å™¨ç½‘æ®µ | 10 | 192.168.10.1 |
| 192.168.20.0/24 | åŠå…¬ç½‘æ®µ1 | 20 | 192.168.20.1 |
| 192.168.30.0/24 | åŠå…¬ç½‘æ®µ2 | 30 | 192.168.30.1 |

### åè®®é…ç½®è¦ç‚¹

**1. OSPFå¤šåŒºåŸŸ**
```
- Area 0: æ ¸å¿ƒå±‚
- Area 1: æ±‡èšå±‚+æ¥å…¥å±‚
- åœ¨æ±‡èšå±‚åšè·¯ç”±æ±‡æ€»
```

**2. VRRPé«˜å¯ç”¨**
```
SW-Core1å’ŒSW-Core2é…ç½®VRRP
è™šæ‹ŸIP: 192.168.10.254 (ä½œä¸ºæœåŠ¡å™¨ç½‘å…³)
```

**3. MSTPç”Ÿæˆæ ‘**
```
å®ä¾‹1: VLAN 10, 20 (SW-Core1ä¸ºæ ¹)
å®ä¾‹2: VLAN 30, 40 (SW-Core2ä¸ºæ ¹)
```

### è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯

**åœºæ™¯1ï¼šæ‰¹é‡è®¾å¤‡å·¡æ£€**
- å¹¶å‘è¿æ¥15å°è®¾å¤‡
- é‡‡é›†CPU/å†…å­˜/æ¥å£çŠ¶æ€
- ç”ŸæˆExcelæŠ¥å‘Š

**åœºæ™¯2ï¼šOSPFé‚»å±…æ£€æµ‹**
```python
# æ‰§è¡Œå‘½ä»¤
output = ssh.execute(b"display ospf peer brief")

# è§£æé‚»å±…çŠ¶æ€
neighbors = parse_ospf_neighbors(output)

# å‘Šè­¦æ£€æµ‹
for nbr in neighbors:
    if nbr['state'] != 'Full':
        send_alert(f"OSPFé‚»å±…å¼‚å¸¸: {nbr['neighbor_id']}")
```

**åœºæ™¯3ï¼šVRRPçŠ¶æ€ç›‘æ§**
- æ£€æµ‹VRRP Master/BackupçŠ¶æ€
- æ¨¡æ‹Ÿæ•…éšœåˆ‡æ¢
- éªŒè¯è‡ªåŠ¨åŒ–è„šæœ¬èƒ½å¦æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–

**åœºæ™¯4ï¼šæµé‡ç›‘æ§**
- é€šè¿‡SNMPé‡‡é›†æ¥å£æµé‡
- ç»˜åˆ¶æµé‡è¶‹åŠ¿å›¾ï¼ˆä½¿ç”¨matplotlibï¼‰
- è¶…é˜ˆå€¼å‘Šè­¦

---

## æ–¹æ¡ˆä¸‰ï¼šå¤šç«™ç‚¹ä¼ä¸šç½‘ç»œï¼ˆé«˜çº§ï¼‰

### æ‹“æ‰‘æ¶æ„å›¾

```
                         Internet
                             |
                    +-------[ISP]-------+
                    |                   |
               [æ€»éƒ¨æ•°æ®ä¸­å¿ƒ]        [åˆ†æ”¯æœºæ„1]
                    |                   |
            [åŒæ ¸å¿ƒ+åŒå‡ºå£]          [å•è·¯ç”±å™¨]
                    |                   |
          [æ±‡èšå±‚/æ¥å…¥å±‚]            [æ¥å…¥äº¤æ¢æœº]
                    |                   |
            [DMZåŒº/åŠå…¬åŒº]           [åŠå…¬PC]
                    
                  MPLS VPN / IPsec VPN è¿æ¥
```

### è®¾å¤‡æ¸…å•ï¼ˆ20+å°è®¾å¤‡ï¼‰

**æ€»éƒ¨ï¼ˆ15å°ï¼‰**
- è¾¹ç•Œè·¯ç”±å™¨: 2å°
- æ ¸å¿ƒäº¤æ¢æœº: 2å°
- æ±‡èšäº¤æ¢æœº: 4å°
- æ¥å…¥äº¤æ¢æœº: 6å°
- é˜²ç«å¢™: 1å°

**åˆ†æ”¯æœºæ„ï¼ˆ5å°ï¼‰**
- è¾¹ç•Œè·¯ç”±å™¨: 1å°
- æ ¸å¿ƒäº¤æ¢æœº: 1å°
- æ¥å…¥äº¤æ¢æœº: 3å°

### æ–°å¢åè®®/æŠ€æœ¯

1. **BGPè·¯ç”±**
   - æ€»éƒ¨ä¸ISPå»ºç«‹eBGP
   - æ€»éƒ¨ä¸åˆ†æ”¯å»ºç«‹iBGP

2. **VPNæŠ€æœ¯**
   - IPsec VPNï¼ˆæ€»éƒ¨-åˆ†æ”¯ï¼‰
   - GRE Tunnel + IPsec

3. **QoS**
   - è¯­éŸ³æµé‡ä¼˜å…ˆçº§
   - æµé‡æ•´å½¢

4. **å®‰å…¨ç­–ç•¥**
   - ACLè®¿é—®æ§åˆ¶
   - é˜²ç«å¢™è§„åˆ™

### é«˜çº§å·¡æ£€åœºæ™¯

**åœºæ™¯1ï¼šå¤šç«™ç‚¹ç»Ÿä¸€å·¡æ£€**
```python
# é…ç½®æ–‡ä»¶ï¼šsites.ini
[headquarters]
devices = R-WAN1, R-WAN2, SW-Core1, SW-Core2, ...

[branch_office1]
devices = R-Branch1, SW-Branch1, ...

# è„šæœ¬æŒ‰ç«™ç‚¹åˆ†ç»„å·¡æ£€
for site in sites:
    report = inspect_site(site)
    send_report_to(site.manager_email, report)
```

**åœºæ™¯2ï¼šVPNéš§é“ç›‘æ§**
- æ£€æµ‹IPsecéš§é“çŠ¶æ€
- æµ‹è¯•éš§é“å»¶è¿Ÿå’Œä¸¢åŒ…ç‡
- è‡ªåŠ¨é‡å¯æ•…éšœéš§é“

**åœºæ™¯3ï¼šBGPè·¯ç”±ç›‘æ§**
- æ£€æµ‹BGPé‚»å±…çŠ¶æ€
- åˆ†æè·¯ç”±è¡¨å˜åŒ–
- å‘Šè­¦è·¯ç”±éœ‡è¡

**åœºæ™¯4ï¼šç½‘ç»œæ‹“æ‰‘è‡ªåŠ¨å‘ç°**
- é€šè¿‡LLDPåè®®å‘ç°æ‰€æœ‰è®¾å¤‡
- ä½¿ç”¨NetworkXæ„å»ºæ‹“æ‰‘å›¾
- ç”Ÿæˆäº¤äº’å¼Webæ‹“æ‰‘å›¾

---

## ğŸ› ï¸ è®¾å¤‡é…ç½®æ¸…å•ï¼ˆé€šç”¨ï¼‰

### æ‰€æœ‰è®¾å¤‡å¿…é¡»é…ç½®

1. **SSHæœåŠ¡å¯ç”¨**
```
user-interface vty 0 4
 authentication-mode aaa
 protocol inbound ssh

aaa
 local-user netconftest password cipher huaweiDC
 local-user netconftest privilege level 15
 local-user netconftest service-type ssh

ssh user netconftest authentication-type password
stelnet server enable
```

2. **SNMPé…ç½®**
```
snmp-agent
snmp-agent sys-info version v2c v3
snmp-agent community read public
snmp-agent community write private
snmp-agent sys-info contact admin@example.com
snmp-agent sys-info location DataCenter-Floor3
```

3. **ç®¡ç†æ¥å£**
```
interface Vlanif99
 description Management
 ip address 10.0.0.X 255.255.255.0
```

4. **æ—¥å¿—æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰**
```
info-center enable
info-center loghost 10.0.0.100
```

### æ¨èçš„è®¾å¤‡å‘½åè§„èŒƒ

```
[ç«™ç‚¹ä»£ç ]-[è®¾å¤‡ç±»å‹][æ¥¼å±‚]-[åºå·]

ä¾‹å¦‚ï¼š
HQ-R-WAN1  (æ€»éƒ¨-è·¯ç”±å™¨-WAN-1å·)
HQ-SW-C1   (æ€»éƒ¨-äº¤æ¢æœº-Core-1å·)
HQ-SW-A2F3 (æ€»éƒ¨-äº¤æ¢æœº-Access-2å·æ¥¼3å±‚)
BR1-R1     (åˆ†æ”¯1-è·¯ç”±å™¨-1å·)
```

---

## ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯è®¾è®¡

### æµ‹è¯•åœºæ™¯1ï¼šè®¾å¤‡å¯è¾¾æ€§æ£€æµ‹

**ç›®æ ‡**: éªŒè¯æ‰€æœ‰è®¾å¤‡åœ¨çº¿ä¸”å¯ç®¡ç†

**æµ‹è¯•æ­¥éª¤**:
```python
# 1. ä»é…ç½®æ–‡ä»¶è¯»å–è®¾å¤‡åˆ—è¡¨
devices = load_devices_from_config()

# 2. æ‰¹é‡Pingæµ‹è¯•
results = {}
for device in devices:
    is_reachable = ping(device['ip'], timeout=3)
    results[device['name']] = is_reachable

# 3. ç”ŸæˆæŠ¥å‘Š
generate_reachability_report(results)

# 4. å‘Šè­¦ä¸å¯è¾¾è®¾å¤‡
unreachable = [d for d, status in results.items() if not status]
if unreachable:
    send_alert(f"è®¾å¤‡ç¦»çº¿: {', '.join(unreachable)}")
```

**é¢„æœŸç»“æœ**: æ‰€æœ‰è®¾å¤‡Pingé€šï¼ŒæŠ¥å‘Šæ˜¾ç¤º100%å¯ç”¨ç‡

---

### æµ‹è¯•åœºæ™¯2ï¼šè®¾å¤‡æ€§èƒ½é‡‡é›†

**ç›®æ ‡**: é‡‡é›†CPUã€å†…å­˜ã€æ¥å£çŠ¶æ€

**æµ‹è¯•æ­¥éª¤**:
```python
from my_visual_ssh import VisualSSH

def collect_device_info(host, username, password):
    ssh = VisualSSH(host, username=username, password=password)
    ssh.read_until(b'>')
    ssh.write(b'system-view')
    ssh.read_until(b']')
    
    # é‡‡é›†CPU
    cpu_output = ssh.execute(b'display cpu-usage')
    cpu_usage = parse_cpu_usage(cpu_output)
    
    # é‡‡é›†å†…å­˜
    mem_output = ssh.execute(b'display memory-usage')
    mem_usage = parse_memory_usage(mem_output)
    
    # é‡‡é›†æ¥å£
    intf_output = ssh.execute(b'display interface brief')
    interfaces = parse_interfaces(intf_output)
    
    ssh.close()
    
    return {
        'cpu': cpu_usage,
        'memory': mem_usage,
        'interfaces': interfaces
    }
```

**é¢„æœŸç»“æœ**: 
- CPU < 80%
- å†…å­˜ < 70%
- å…³é”®æ¥å£UpçŠ¶æ€

---

### æµ‹è¯•åœºæ™¯3ï¼šSNMPæ•°æ®é‡‡é›†

**ç›®æ ‡**: é€šè¿‡SNMPé‡‡é›†å®æ—¶æµé‡

**æµ‹è¯•æ­¥éª¤**:
```python
from pysnmp.hlapi import *

def get_interface_traffic(host, interface_index):
    """
    è·å–æ¥å£æµé‡ï¼ˆå­—èŠ‚æ•°ï¼‰
    OID: ifInOctets / ifOutOctets
    """
    # å…¥æµé‡
    oid_in = f'1.3.6.1.2.1.2.2.1.10.{interface_index}'
    in_octets = snmp_get(host, oid_in)
    
    # å‡ºæµé‡
    oid_out = f'1.3.6.1.2.1.2.2.1.16.{interface_index}'
    out_octets = snmp_get(host, oid_out)
    
    return {
        'in': in_octets,
        'out': out_octets
    }

# è®¡ç®—æµé‡é€Ÿç‡
traffic_1 = get_interface_traffic('10.0.0.10', 1)
time.sleep(10)
traffic_2 = get_interface_traffic('10.0.0.10', 1)

rate_in = (traffic_2['in'] - traffic_1['in']) / 10  # Bytes/s
rate_out = (traffic_2['out'] - traffic_1['out']) / 10
```

**é¢„æœŸç»“æœ**: æˆåŠŸé‡‡é›†åˆ°æµé‡æ•°æ®ï¼Œæ— SNMPè¶…æ—¶é”™è¯¯

---

### æµ‹è¯•åœºæ™¯4ï¼šç½‘ç»œæ‹“æ‰‘å‘ç°ï¼ˆNetworkXï¼‰

**ç›®æ ‡**: é€šè¿‡LLDPåè®®è‡ªåŠ¨å‘ç°æ‹“æ‰‘

**æµ‹è¯•æ­¥éª¤**:
```python
import networkx as nx
import matplotlib.pyplot as plt

def discover_topology(seed_device):
    G = nx.Graph()
    visited = set()
    queue = [seed_device]
    
    while queue:
        device = queue.pop(0)
        if device in visited:
            continue
            
        visited.add(device)
        
        # è¿æ¥è®¾å¤‡å¹¶è·å–LLDPä¿¡æ¯
        ssh = connect_device(device)
        lldp_output = ssh.execute(b'display lldp neighbor brief')
        neighbors = parse_lldp(lldp_output)
        
        for nbr in neighbors:
            G.add_edge(device, nbr['remote_device'])
            if nbr['remote_device'] not in visited:
                queue.append(nbr['remote_device'])
        
        ssh.close()
    
    return G

# ç»˜åˆ¶æ‹“æ‰‘å›¾
G = discover_topology('10.0.0.10')
nx.draw(G, with_labels=True, node_color='lightblue', 
        node_size=1500, font_size=10)
plt.savefig('network_topology.png')
```

**é¢„æœŸç»“æœ**: ç”Ÿæˆå®Œæ•´çš„ç½‘ç»œæ‹“æ‰‘å›¾

---

### æµ‹è¯•åœºæ™¯5ï¼šé…ç½®å¤‡ä»½

**ç›®æ ‡**: è‡ªåŠ¨å¤‡ä»½æ‰€æœ‰è®¾å¤‡é…ç½®åˆ°Git

**æµ‹è¯•æ­¥éª¤**:
```python
import os
from datetime import datetime

def backup_device_config(device):
    ssh = connect_device(device['ip'])
    
    # è·å–é…ç½®
    config = ssh.execute(b'display current-configuration')
    
    # ä¿å­˜åˆ°æ–‡ä»¶
    backup_dir = f"./backups/{datetime.now().strftime('%Y-%m-%d')}"
    os.makedirs(backup_dir, exist_ok=True)
    
    filename = f"{backup_dir}/{device['name']}.cfg"
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(config)
    
    ssh.close()
    return filename

# æ‰¹é‡å¤‡ä»½
for device in all_devices:
    backup_file = backup_device_config(device)
    print(f"å·²å¤‡ä»½: {backup_file}")

# æäº¤åˆ°Git
os.system('git add backups/')
os.system(f'git commit -m "Config backup {datetime.now()}"')
os.system('git push')
```

**é¢„æœŸç»“æœ**: æ‰€æœ‰é…ç½®æ–‡ä»¶ä¿å­˜åœ¨Gitä»“åº“ä¸­

---

## ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•

### æµ‹è¯•æŒ‡æ ‡

| æŒ‡æ ‡ | å°å‹æ‹“æ‰‘ | ä¸­å‹æ‹“æ‰‘ | å¤§å‹æ‹“æ‰‘ |
|------|---------|---------|---------|
| è®¾å¤‡æ•°é‡ | 6å° | 15å° | 30å° |
| å…¨è®¾å¤‡å·¡æ£€æ—¶é—´ | <30ç§’ | <2åˆ†é’Ÿ | <5åˆ†é’Ÿ |
| å•è®¾å¤‡è¿æ¥æ—¶é—´ | <3ç§’ | <3ç§’ | <3ç§’ |
| æŠ¥å‘Šç”Ÿæˆæ—¶é—´ | <5ç§’ | <10ç§’ | <20ç§’ |
| å¹¶å‘è¿æ¥æ•° | 5 | 10 | 20 |

### ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨å¤šçº¿ç¨‹**
```python
from concurrent.futures import ThreadPoolExecutor

with ThreadPoolExecutor(max_workers=10) as executor:
    results = executor.map(inspect_device, devices)
```

2. **ä½¿ç”¨è¿æ¥æ± **
```python
# ä¿æŒSSHè¿æ¥ï¼Œé¿å…é‡å¤è¿æ¥
class SSHConnectionPool:
    def __init__(self):
        self.connections = {}
    
    def get_connection(self, host):
        if host not in self.connections:
            self.connections[host] = VisualSSH(host, ...)
        return self.connections[host]
```

3. **ç¼“å­˜è®¾å¤‡ä¿¡æ¯**
```python
# ä¸éœ€è¦æ¯æ¬¡éƒ½æŸ¥è¯¢versionç­‰å›ºå®šä¿¡æ¯
cache = {
    'device1': {
        'version': 'V200R005C10',
        'last_update': '2025-10-15'
    }
}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

### Step 1: ä¸‹è½½æ‹“æ‰‘æ–‡ä»¶

**eNSPæ‹“æ‰‘æ–‡ä»¶ï¼ˆå·²å‡†å¤‡å¥½çš„ï¼‰**:
```
å°å‹æ‹“æ‰‘: topology_small.topo
ä¸­å‹æ‹“æ‰‘: topology_medium.topo
```

*ï¼ˆæ³¨ï¼šæ‚¨éœ€è¦æ ¹æ®ä¸Šè¿°è®¾è®¡è‡ªå·±åœ¨eNSPä¸­æ­å»ºï¼Œæˆ–è€…æˆ‘å¯ä»¥å¸®æ‚¨ç”Ÿæˆé…ç½®è„šæœ¬ï¼‰*

### Step 2: å¯¼å…¥æ‹“æ‰‘åˆ°eNSP

1. æ‰“å¼€eNSPè½¯ä»¶
2. æ–‡ä»¶ â†’ å¯¼å…¥æ‹“æ‰‘
3. é€‰æ‹©å¯¹åº”çš„.topoæ–‡ä»¶
4. å¯åŠ¨æ‰€æœ‰è®¾å¤‡

### Step 3: æ‰§è¡ŒåŸºç¡€é…ç½®

```bash
# ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬æ‰¹é‡é…ç½®ï¼ˆå¯é€‰ï¼‰
python scripts/init_devices.py --topology small
```

### Step 4: æµ‹è¯•å·¡æ£€è„šæœ¬

```bash
# è¿è¡ŒåŸºç¡€å·¡æ£€
python main_refactored.py

# æŸ¥çœ‹æŠ¥å‘Š
ls reports/
```

---

## ğŸ“ æ€»ç»“ä¸å»ºè®®

### æ¨èå­¦ä¹ è·¯å¾„

1. **ç¬¬1å‘¨**: æ­å»ºæ–¹æ¡ˆä¸€ï¼ˆå°å‹æ‹“æ‰‘ï¼‰ï¼ŒéªŒè¯åŸºç¡€åŠŸèƒ½
2. **ç¬¬2-3å‘¨**: å®Œå–„å·¡æ£€è„šæœ¬ï¼Œæ·»åŠ æŠ¥å‘Šç”Ÿæˆ
3. **ç¬¬4-5å‘¨**: å‡çº§åˆ°æ–¹æ¡ˆäºŒï¼Œæµ‹è¯•SNMPå’Œæ‹“æ‰‘å‘ç°
4. **ç¬¬6-8å‘¨**: æŒ‘æˆ˜æ–¹æ¡ˆä¸‰ï¼Œå®ç°å®Œæ•´è‡ªåŠ¨åŒ–å¹³å°

### å¸¸è§é—®é¢˜

**Q1: eNSPèµ„æºä¸å¤Ÿï¼Œè®¾å¤‡å¯åŠ¨ä¸äº†ï¼Ÿ**
A: å‡å°‘è®¾å¤‡æ•°é‡æˆ–ä½¿ç”¨äº‘å¹³å°ï¼ˆé˜¿é‡Œäº‘/åä¸ºäº‘ï¼‰çš„è™šæ‹Ÿè®¾å¤‡

**Q2: è®¾å¤‡é…ç½®å¤ªå¤æ‚ï¼Ÿ**
A: ä½¿ç”¨æˆ‘æä¾›çš„é…ç½®æ¨¡æ¿ï¼Œç›´æ¥ç²˜è´´åˆ°è®¾å¤‡

**Q3: Pythonè„šæœ¬è¿æ¥è¶…æ—¶ï¼Ÿ**
A: æ£€æŸ¥è®¾å¤‡ç®¡ç†IPæ˜¯å¦é…ç½®æ­£ç¡®ï¼ŒSSHæœåŠ¡æ˜¯å¦å¯ç”¨

---

## ğŸ“š é™„å½•

### é™„å½•Aï¼šå®Œæ•´è®¾å¤‡é…ç½®æ¨¡æ¿

[æŸ¥çœ‹ device_config_templates/ ç›®å½•]

### é™„å½•Bï¼šå·¡æ£€è„šæœ¬ç¤ºä¾‹

[æŸ¥çœ‹ scripts/inspection_examples/ ç›®å½•]

### é™„å½•Cï¼šeNSPæ‹“æ‰‘æ–‡ä»¶

[æŸ¥çœ‹ topologies/ ç›®å½•]

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-15  
**é€‚ç”¨é¡¹ç›®**: Pythonç½‘ç»œè®¾å¤‡è‡ªåŠ¨åŒ–å·¡æ£€å¹³å°  
**ä½œè€…**: è¢ç‘

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: é€‰æ‹©ä¸€ä¸ªæ‹“æ‰‘æ–¹æ¡ˆï¼Œå¼€å§‹æ­å»ºå®éªŒç¯å¢ƒï¼ğŸš€

